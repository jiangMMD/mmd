<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mmd.dao.ProductDao">
    <resultMap id="productInfo" type="productsinfo">
        <id column="pid" property="pid"></id>
        <result column="mer_id" property="merId"></result>
        <result column="state" property="state"></result>
        <result column="prodno" property="prodno"></result>
        <result column="pname" property="pname"></result>
        <result column="title" property="title"></result>
        <result column="desc" property="desc"></result>
        <result column="homeimg" property="homeimg"></result>
        <result column="paramimg" property="paramimg"></result>
        <result column="categoryid" property="categoryid"></result>
        <result column="isproportion" property="isproportion"></result>
        <result column="shopprice" property="shopprice"></result>
        <result column="shopmmdprice" property="shopmmdprice"></result>
        <result column="costprice" property="costprice"></result>
        <result column="isbest" property="isbest"></result>
        <result column="ishot" property="ishot"></result>
        <result column="isnew" property="isnew"></result>
        <result column="isfree" property="isfree"></result>
        <result column="expressfee" property="expressfee"></result>
        <result column="weight" property="weight"></result>
        <result column="volume" property="volume"></result>
        <result column="inventory" property="inventory"></result>
        <result column="sell" property="sell"></result>
        <result column="commentcount" property="commentcount"></result>
        <result column="bestcount" property="bestcount"></result>
        <result column="mediumccount" property="mediumccount"></result>
        <result column="badcount" property="badcount"></result>
        <result column="average" property="average"></result>
        <result column="isflashview" property="isflashview"></result>
        <result column="service_ids" property="serviceIds"></result>
        <result column="crtuser" property="crtuser"></result>
        <result column="crtdate" property="crtdate"></result>
        <result column="recsts" property="recsts"></result>
        <collection property="carousalList" ofType="map" javaType="arrayList">
            <id column="id" property="id"></id>
            <result column="pd_url" property="pd_url"></result>
            <result column="pd_order" property="pd_order"></result>
        </collection>
    </resultMap>

    <select id="getProClassifyByKey" resultType="map">
        select id, `name` text  from classify
        <where>
            recsts = '1'
            <if test="key != null and key != ''">
                and `name` like concat('%', #{key}, '%')
            </if>
            order by `order`
        </where>
        limit 10
    </select>

    <select id="getProductList" resultType="Productsinfo" parameterType="Productsinfo">
        select p.pid,p.mer_id,p.state,p.pname,p.title,p.desc,p.homeimg,p.paramimg,p.categoryid,p.shopprice,
        p.shopmmdprice,p.costprice,p.isbest,p.ishot,p.isnew,p.isfree,p.inventory,p.expressfee,p.weight,p.volume,
        p.sell,p.commentcount,p.bestcount,p.mediumccount,p.badcount,p.average,p.isflashview,p.prodno,service_ids,
        p.crtuser,p.crtdate,p.recsts,mer_name,
        (select c.name from classify c where c.id = p.categoryid) proClassify
        from productsinfo p left join merchant m on p.mer_id = m.mer_id where p.recsts != 'D'
        <if test="merName != null and merName !=''">
            and m.mer_name like concat('%', #{merName}, '%')
        </if>
        <if test="prodno != null and prodno !=''">
            and prodno like concat('%', #{prodno}, '%')
        </if>
        <if test="pname != null and pname != ''">
            and pname like concat('%', #{pname}, '%')
        </if>
        <if test="categoryid != null and categoryid != ''">
            and categoryid = #{categoryid}
        </if>
        <if test="state != null and state != ''">
            and state = #{state}
        </if>
    </select>


    <update id="delProduct">
        update productsinfo set recsts = 'D' where pid in <foreach collection="ids" item="id" open="(" close=")" separator=",">#{id}</foreach>
    </update>

    <update id="uplineProduct">
        update productsinfo set state = '1' where pid in <foreach collection="ids" item="id" open="(" close=")" separator=",">#{id}</foreach>
    </update>

    <update id="downlineProduct">
        update productsinfo set state = '2' where pid in <foreach collection="ids" item="id" open="(" close=")" separator=",">#{id}</foreach>
    </update>

    <select id="getProductDetail" resultType="productsinfo">
        select * from productsinfo where pid = #{id}
    </select>

    <select id="getProdCarousal" resultType="prodCarousal">
        select * from prod_carousal where pid = #{id}
        order by pd_order
    </select>

    <select id="getCarousalList" resultType="ProdCarousal" parameterType="ProdCarousal">
                select * from prod_carousal where pid = #{id}
        order by pd_order
    </select>
</mapper>